{
  "test": "STP and HTP Commission Validation",
  "path": "e2e/wallets/wallet-stp-htp.json",
  "description": "End-to-end test validating STP and HTP calculations with and without commission using division method",
  "steps": [
    "Scenario 1: No Commission Stock - Price Progression",
    "  Step 1: Create stock E2ESTPHTP without commission (STP=10%, HTP=20%)",
    "  Step 2: Add buy transaction at $100 with $200 investment (Split)",
    "  Step 3: Validate STP/HTP at $100 baseline (below targets)",
    "  Step 4: Update test price to $109 and validate near-STP yellow indicators",
    "  Step 5: Update test price to $115 and validate STP met (green indicators)",
    "  Step 6: Update test price to $122 and validate both STP and HTP met (all green)",
    "Scenario 2: With 0.5% Commission - Price Progression",
    "  Step 7: Create stock E2ESTPHTPCOM with 0.5% commission (STP=10%, HTP=20%)",
    "  Step 8: Add buy transaction at $100 with $200 investment (Split)",
    "  Step 9: Validate STP/HTP at $100 baseline with commission factored (STP=$110.55, HTP=$120.60)",
    "  Step 10: Update test price to $109 and validate commission impact on percentages",
    "  Step 11: Update test price to $115 and validate STP met with commission",
    "  Step 12: Update test price to $122 and validate both targets met",
    "  Step 13: Update buy transaction price from $100 to $105",
    "  Step 14: Validate STP/HTP recalculation at $122 (new STP=$116.08, HTP=$126.63, %2HTP becomes negative)"
  ],
  "colorDefinitions": {
    "default": "rgb(0, 0, 0)",
    "green": "rgb(144, 238, 144)",
    "yellow": "rgb(237, 255, 0)"
  },
  "testData": {
    "stocks": {
      "NO_COMMISSION_STOCK": {
        "symbol": "E2ESTPHTP",
        "name": "E2E STP HTP No Commission",
        "stockType": "Stock",
        "region": "US",
        "marketCategory": "US_Index",
        "riskGrowthProfile": "Hare",
        "budget": 1000,
        "swingHoldRatio": 50,
        "pdp": 5,
        "stp": 10,
        "htp": 20,
        "stockCommission": 0,
        "testPrice": 100
      },
      "WITH_COMMISSION_STOCK": {
        "symbol": "E2ESTPHTPCOM",
        "name": "E2E STP HTP With Commission",
        "stockType": "Stock",
        "region": "US",
        "marketCategory": "US_Index",
        "riskGrowthProfile": "Hare",
        "budget": 1000,
        "swingHoldRatio": 50,
        "pdp": 5,
        "stp": 10,
        "htp": 20,
        "stockCommission": 0.5,
        "testPrice": 100
      }
    }
  },
  "scenarios": [
    {
      "id": "no_commission_progression",
      "name": "No Commission Stock - Price Progression",
      "description": "Tests STP/HTP at multiple price points for stock without commission",
      "setup": {
        "stock": "NO_COMMISSION_STOCK",
        "transactions": [
          {
            "action": "Buy",
            "txnType": "Split",
            "signal": "Initial",
            "price": 100,
            "investment": 200,
            "date": "2025-09-11"
          }
        ]
      },
      "priceProgression": [
        {
          "price": 100,
          "label": "$100 - Baseline",
          "validations": {
            "walletsOverview": {
              "stpSetting": "10%",
              "htpSetting": "20%"
            },
            "signalsTable": {
              "percentToStp": "-9.09%",
              "percentToHtp": "-16.67%",
              "stpColor": "default",
              "htpColor": "default"
            },
            "walletTabs": {
              "swing": {
                "stpValue": "$110.00",
                "percentToStp": "-9.09%",
                "htpValue": "$120.00",
                "percentToHtp": "-16.67%",
                "stpValueColor": "default",
                "percentToStpColor": "default",
                "htpValueColor": "default",
                "percentToHtpColor": "default"
              },
              "hold": {
                "stpValue": "$110.00",
                "percentToStp": "-9.09%",
                "htpValue": "$120.00",
                "percentToHtp": "-16.67%",
                "stpValueColor": "default",
                "percentToStpColor": "default",
                "htpValueColor": "default",
                "percentToHtpColor": "default"
              }
            }
          }
        },
        {
          "price": 109,
          "label": "$109 - Near STP",
          "validations": {
            "signalsTable": {
              "percentToStp": "-0.91%",
              "percentToHtp": "-9.17%",
              "stpColor": "yellow",
              "htpColor": "default"
            },
            "walletTabs": {
              "swing": {
                "stpValue": "$110.00",
                "percentToStp": "-0.91%",
                "htpValue": "$120.00",
                "percentToHtp": "-9.17%",
                "stpValueColor": "default",
                "percentToStpColor": "default",
                "htpValueColor": "default",
                "percentToHtpColor": "default"
              },
              "hold": {
                "stpValue": "$110.00",
                "percentToStp": "-0.91%",
                "htpValue": "$120.00",
                "percentToHtp": "-9.17%",
                "stpValueColor": "default",
                "percentToStpColor": "default",
                "htpValueColor": "default",
                "percentToHtpColor": "default"
              }
            }
          }
        },
        {
          "price": 115,
          "label": "$115 - STP Met",
          "validations": {
            "signalsTable": {
              "percentToStp": "4.55%",
              "percentToHtp": "-4.17%",
              "stpColor": "green",
              "htpColor": "default"
            },
            "walletTabs": {
              "swing": {
                "stpValue": "$110.00",
                "percentToStp": "4.55%",
                "htpValue": "$120.00",
                "percentToHtp": "-4.17%",
                "stpValueColor": "green",
                "percentToStpColor": "green",
                "htpValueColor": "default",
                "percentToHtpColor": "default"
              },
              "hold": {
                "stpValue": "$110.00",
                "percentToStp": "4.55%",
                "htpValue": "$120.00",
                "percentToHtp": "-4.17%",
                "stpValueColor": "green",
                "percentToStpColor": "green",
                "htpValueColor": "default",
                "percentToHtpColor": "default"
              }
            }
          }
        },
        {
          "price": 122,
          "label": "$122 - Both Met",
          "validations": {
            "signalsTable": {
              "percentToStp": "10.91%",
              "percentToHtp": "1.67%",
              "stpColor": "green",
              "htpColor": "green"
            },
            "walletTabs": {
              "swing": {
                "stpValue": "$110.00",
                "percentToStp": "10.91%",
                "htpValue": "$120.00",
                "percentToHtp": "1.67%",
                "stpValueColor": "green",
                "percentToStpColor": "green",
                "htpValueColor": "green",
                "percentToHtpColor": "green"
              },
              "hold": {
                "stpValue": "$110.00",
                "percentToStp": "10.91%",
                "htpValue": "$120.00",
                "percentToHtp": "1.67%",
                "stpValueColor": "green",
                "percentToStpColor": "green",
                "htpValueColor": "green",
                "percentToHtpColor": "green"
              }
            }
          }
        }
      ]
    },
    {
      "id": "with_commission_progression",
      "name": "With 0.5% Commission - Price Progression",
      "description": "Tests STP/HTP at multiple price points for stock with 0.5% commission",
      "setup": {
        "stock": "WITH_COMMISSION_STOCK",
        "transactions": [
          {
            "action": "Buy",
            "txnType": "Split",
            "signal": "Initial",
            "price": 100,
            "investment": 200,
            "date": "2025-09-11"
          }
        ]
      },
      "priceProgression": [
        {
          "price": 100,
          "label": "$100 - Baseline",
          "validations": {
            "walletsOverview": {
              "stpSetting": "10%",
              "htpSetting": "20%"
            },
            "signalsTable": {
              "percentToStp": "-9.55%",
              "percentToHtp": "-17.08%",
              "stpColor": "default",
              "htpColor": "default"
            },
            "walletTabs": {
              "swing": {
                "stpValue": "$110.55",
                "percentToStp": "-9.55%",
                "htpValue": "$120.60",
                "percentToHtp": "-17.08%",
                "stpValueColor": "default",
                "percentToStpColor": "default",
                "htpValueColor": "default",
                "percentToHtpColor": "default"
              },
              "hold": {
                "stpValue": "$110.55",
                "percentToStp": "-9.55%",
                "htpValue": "$120.60",
                "percentToHtp": "-17.08%",
                "stpValueColor": "default",
                "percentToStpColor": "default",
                "htpValueColor": "default",
                "percentToHtpColor": "default"
              }
            }
          }
        },
        {
          "price": 109,
          "label": "$109 - Near STP",
          "validations": {
            "signalsTable": {
              "percentToStp": "-1.40%",
              "percentToHtp": "-9.62%",
              "stpColor": "default",
              "htpColor": "default"
            },
            "walletTabs": {
              "swing": {
                "stpValue": "$110.55",
                "percentToStp": "-1.40%",
                "htpValue": "$120.60",
                "percentToHtp": "-9.62%",
                "stpValueColor": "default",
                "percentToStpColor": "default",
                "htpValueColor": "default",
                "percentToHtpColor": "default"
              },
              "hold": {
                "stpValue": "$110.55",
                "percentToStp": "-1.40%",
                "htpValue": "$120.60",
                "percentToHtp": "-9.62%",
                "stpValueColor": "default",
                "percentToStpColor": "default",
                "htpValueColor": "default",
                "percentToHtpColor": "default"
              }
            }
          }
        },
        {
          "price": 115,
          "label": "$115 - STP Met",
          "validations": {
            "signalsTable": {
              "percentToStp": "4.02%",
              "percentToHtp": "-4.65%",
              "stpColor": "green",
              "htpColor": "default"
            },
            "walletTabs": {
              "swing": {
                "stpValue": "$110.55",
                "percentToStp": "4.02%",
                "htpValue": "$120.60",
                "percentToHtp": "-4.65%",
                "stpValueColor": "green",
                "percentToStpColor": "green",
                "htpValueColor": "default",
                "percentToHtpColor": "default"
              },
              "hold": {
                "stpValue": "$110.55",
                "percentToStp": "4.02%",
                "htpValue": "$120.60",
                "percentToHtp": "-4.65%",
                "stpValueColor": "green",
                "percentToStpColor": "green",
                "htpValueColor": "default",
                "percentToHtpColor": "default"
              }
            }
          }
        },
        {
          "price": 122,
          "label": "$122 - Both Met",
          "validations": {
            "signalsTable": {
              "percentToStp": "10.35%",
              "percentToHtp": "1.16%",
              "stpColor": "green",
              "htpColor": "green"
            },
            "walletTabs": {
              "swing": {
                "stpValue": "$110.55",
                "percentToStp": "10.35%",
                "htpValue": "$120.60",
                "percentToHtp": "1.16%",
                "stpValueColor": "green",
                "percentToStpColor": "green",
                "htpValueColor": "green",
                "percentToHtpColor": "green"
              },
              "hold": {
                "stpValue": "$110.55",
                "percentToStp": "10.35%",
                "htpValue": "$120.60",
                "percentToHtp": "1.16%",
                "stpValueColor": "green",
                "percentToStpColor": "green",
                "htpValueColor": "green",
                "percentToHtpColor": "green"
              }
            }
          }
        },
        {
          "price": 122,
          "label": "$122 - After Buy Price Update to $105",
          "transactionUpdates": [
            {
              "oldPrice": 100,
              "newPrice": 105,
              "label": "Update buy price to $105"
            }
          ],
          "validations": {
            "walletsOverview": {
              "stpSetting": "10%",
              "htpSetting": "20%"
            },
            "signalsTable": {
              "percentToStp": "5.10%",
              "percentToHtp": "-3.66%",
              "stpColor": "green",
              "htpColor": "default"
            },
            "walletTabs": {
              "swing": {
                "stpValue": "$116.08",
                "percentToStp": "5.10%",
                "htpValue": "$126.63",
                "percentToHtp": "-3.66%",
                "stpValueColor": "green",
                "percentToStpColor": "green",
                "htpValueColor": "default",
                "percentToHtpColor": "default"
              },
              "hold": {
                "stpValue": "$116.08",
                "percentToStp": "5.10%",
                "htpValue": "$126.63",
                "percentToHtp": "-3.66%",
                "stpValueColor": "green",
                "percentToStpColor": "green",
                "htpValueColor": "default",
                "percentToHtpColor": "default"
              }
            }
          }
        }
      ]
    }
  ],
  "cleanupSymbols": ["E2ESTPHTP", "E2ESTPHTPCOM"]
}
