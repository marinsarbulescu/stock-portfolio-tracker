{
  "scenario": "AssetSplit",
  "description": "Stock split transaction testing - verifies split adjustments, date-based behavior, and delete protection",
  "asset": {
    "input": {
      "symbol": "E2E-SPLIT-TEST",
      "name": "Split Test Asset",
      "type": "STOCK",
      "testPrice": "100",
      "commission": "0.5",
      "status": "ACTIVE"
    }
  },
  "entryTargets": [
    { "input": { "name": "ET1", "targetPercent": "2", "sortOrder": "1" } }
  ],
  "profitTargets": [
    { "input": { "name": "PT1", "targetPercent": "8", "allocationPercent": "100", "sortOrder": "1" } }
  ],
  "steps": {
    "step1_basicSplit": {
      "description": "2:1 split doubles shares and halves prices",
      "transactions": [
        {
          "type": "BUY",
          "input": {
            "signal": "INITIAL",
            "price": "10",
            "investment": "1000",
            "allocations": [{ "ptPercent": "8", "percentage": "100" }]
          },
          "expected": {
            "wallets": [
              { "ptPercent": "8", "price": "$10.00", "shares": "100.00000", "investment": "$1,000.00" }
            ]
          }
        },
        {
          "type": "SPLIT",
          "input": { "splitRatio": "2" },
          "expected": {
            "wallets": [
              { "ptPercent": "8", "price": "$5.00", "shares": "200.00000", "investment": "$1,000.00" }
            ]
          }
        }
      ]
    },
    "step2_splitDateBehavior": {
      "description": "Split only affects wallets created before split date",
      "transactions": [
        {
          "type": "BUY",
          "input": {
            "signal": "INITIAL",
            "price": "10",
            "investment": "1000",
            "allocations": [{ "ptPercent": "8", "percentage": "100" }]
          },
          "expected": {
            "wallets": [
              { "ptPercent": "8", "price": "$10.00", "shares": "100.00000", "investment": "$1,000.00" }
            ]
          }
        },
        {
          "type": "SPLIT",
          "input": { "splitRatio": "2" },
          "expected": {
            "wallets": [
              { "ptPercent": "8", "price": "$5.00", "shares": "200.00000", "investment": "$1,000.00" }
            ]
          }
        },
        {
          "type": "BUY",
          "input": {
            "signal": "CUSTOM",
            "price": "5",
            "investment": "250",
            "allocations": [{ "ptPercent": "8", "percentage": "100" }]
          },
          "expected": {
            "wallets": [
              { "ptPercent": "8", "price": "$5.00", "shares": "250.00000", "investment": "$1,250.00" }
            ]
          }
        }
      ]
    },
    "step3_deleteProtection": {
      "description": "Deleting split is prevented if subsequent transactions exist",
      "transactions": [
        {
          "type": "BUY",
          "input": {
            "signal": "INITIAL",
            "price": "10",
            "investment": "1000",
            "allocations": [{ "ptPercent": "8", "percentage": "100" }]
          }
        },
        {
          "type": "SPLIT",
          "input": { "splitRatio": "2" }
        },
        {
          "type": "BUY",
          "input": {
            "signal": "CUSTOM",
            "price": "5",
            "investment": "250",
            "allocations": [{ "ptPercent": "8", "percentage": "100" }]
          }
        },
        {
          "type": "DELETE_SPLIT",
          "expected": {
            "errorMessage": "Cannot delete.*subsequent transactions"
          }
        }
      ]
    }
  }
}
